{% extends 'invoice/index.html' %}

{% block title %}Invoice List{% endblock %}

{% block css %}
{% load static %}
<link rel="stylesheet" href="{% static 'invoice/invoice_list.css' %}">
{% endblock %}

{% load humanize %}
{% block content %}
<div class="header">
    <div class="page_title">
        <h1>Invoice List</h1>
    </div>
    <div class="search-bar">
        <form method="get" action="{% url 'invoicing_app:invoice_list' %}">
            <input type="text" name="q" placeholder="Search..." value="{{ request.GET.q }}">
            <button type="submit"><span data-feather="search"></span> Search</button>
            <button type="button" class="clear-button" onclick="clearSearch()"><span data-feather="x"></span>
                Clear</button>
        </form>
    </div>
</div>
<div class="card scrollable-container">
    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                <th>Client</th>
                <th>Billing Address</th>
                <th>Invoice Date</th>
                <th>Due Date</th>
                <th>Amount Due</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in invoice %}
            <tr>
                <td>{{ invoice.id }}</td>
                <td>{{ invoice.client_name }}</td>
                <td>{{ invoice.billing_address }}</td>
                <td>{{ invoice.created_at|date:"DATE_FORMAT" }}</td>
                <td>{{ invoice.due_date|date:"DATE_FORMAT" }}</td>
                <td>{{ invoice.total_cost | floatformat:2|intcomma }}</td>
                <td>{{ invoice.paid|yesno:"Paid,Unpaid" }}</td>
                <td>
                    <a href="{% url 'invoicing_app:invoice_detail' invoice.id %}" class="btn btn-primary btn-sm"><span
                            data-feather="eye"></span>View</a>
                    <a href="{% url 'invoicing_app:edit_invoice' invoice.id %}" class="btn btn-secondary btn-sm"><span
                            data-feather="edit"></span>Edit</a>
                    <form action="{% url 'invoicing_app:delete_invoice' invoice.id %}" method="post"
                        style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm"
                            onclick="return confirm('Are you sure you want to delete this invoice?');"><span
                                data-feather="trash-2"></span>Delete</button>
                    </form>
                    <div class="btn-group">
                        <button type="button" class="btn btn-info btn-sm dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            Status
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="{% url 'invoicing_app:mark_as_paid' invoice.id %}">Mark as
                                Paid</a>
                            <a class="dropdown-item" href="{% url 'invoicing_app:mark_as_unpaid' invoice.id %}">Mark as
                                Unpaid</a>
                        </div>
                    </div>
                    <!-- Download PDF -->
                    <a href="{% url 'invoicing_app:generate_invoice_pdf' invoice.id %}"
                        class="btn btn-secondary btn-sm"><span data-feather="download"></span>Download</a>
</div>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
<script>
    function clearSearch() {
        // Clear the search input field
        const searchInput = document.querySelector('.search-bar input[name="q"]');
        searchInput.value = '';

        // Redirect to the invoice list page without query parameters
        window.location.href = "{% url 'invoicing_app:invoice_list' %}";
    }
</script>
{% endblock %}